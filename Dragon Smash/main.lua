map = {
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 4, 4, 4, 4, 4, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 3, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 3, 3, 3, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, },
}

-------AT-LEVEL------{  2   3   4    5    6    7    8    9   10   11   12   13    14    15    16    17    18    19     20              21 }
experienceRequired = {  8, 60, 80, 110, 150, 310, 380, 460, 550, 650, 760, 880, 1010, 1150, 1300, 1460, 1630, 1810,  2000, 99999999999999 }
attacksGained      = {  1,  1,  1,   2,   2,   2,   3,   3,   3,   4,   4,   4,    5,    5,    5,    5,    5,    5,     5,             21 }
defenseGained      = {  1,  1,  1,   1,   1,   1,   2,   2,   2,   2,   2,   3,    3,    3,    4,    4,    4,    4,     5,             21 }
healthGained       = {  1,  1,  1,   2,   2,   2,   3,   3,   3,   4,   4,   4,    5,    6,    7,    8,    9,   10,    11,             21 }
magicGained        = {  1,  1,  1,   2,   2,   2,   3,   3,   3,   4,   4,   4,    5,    5,    5,    5,    5,    5,     5,             21 }
-------AT-LEVEL------{  2   3   4    5    6    7    8    9   10   11    12   13    1    15    16,   17,   18,   19,    20,             21 }

love.window.setTitle("Dragon Smash")
love.window.setMode(800, 800)
love.window.setPosition(80, 0)

s1 = love.graphics.newImage("heroS1.png")
s2 = love.graphics.newImage("heroS2.png")
n1 = love.graphics.newImage("heroN1.png")
n2 = love.graphics.newImage("heroN2.png")
w1 = love.graphics.newImage("heroW1.png")
w2 = love.graphics.newImage("heroW2.png")
e1 = love.graphics.newImage("heroE1.png")
e2 = love.graphics.newImage("heroE2.png")

hero = {}
hero.image = s1
hero.healthMax = 0
hero.magicMax = 0
hero.attacks = 0
hero.defense = 0
hero.experience = 0
hero.level = 1
hero.gold = 0

slime = {}
slime.image = love.graphics.newImage("slime.png")
slime.name = "Slime"

redSlime = {}
redSlime.image = love.graphics.newImage("redslime.png")
redSlime.name = "Red Slime"

dracky = {}
dracky.image = love.graphics.newImage("dracky.png")
dracky.name = "Dracky"

greenDragon = {}
greenDragon.image = love.graphics.newImage("greenDragon.png")
greenDragon.name = "Green Dragon"

enemies = {}
enemies[1] = slime
enemies[2] = redSlime
enemies[3] = dracky
enemies[4] = greenDragon
enemy = 0

tile = {}
for i = 0, 4 do
   tile[i] = love.graphics.newImage("tile"..i..".png")
end

onTile = 0
mapX = 13
mapY = 0
mapW = 41
mapH = 46
stat = love.graphics.newImage("status.png")
battleFrame = love.graphics.newImage("battleFrame.png")
battleComm = love.graphics.newImage("commands.png")
worldComm = love.graphics.newImage("commands2.png")
cursor = love.graphics.newImage("cursor.png")
cursorX = 218
cursorY = 110
command = 0
selection = 0
drawMode = 0
steps = 0
encounter = 0
heroSwitch = 0
menuSwitch = 0
battleSwitch = 0
battleRelay = 0
theme = love.audio.newSource("dqowt.wav")
theme:setLooping(true)

function love.load()
   love.graphics.setFont(love.graphics.newFont(16))
   hero.healthMax = love.math.random(18,20)
   hero.health = hero.healthMax
   hero.magicMax = love.math.random(10,12)
   hero.magics = hero.magicMax
   hero.attacks = love.math.random(5,6)
   hero.defense = love.math.random(1,2)
   resetEnemies()
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("DRAGON SMASH")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("Welcome HERO!")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("............")
   love.timer.sleep(0.12)
   print("\'WASD\' for")
   love.timer.sleep(0.12)
   print("char./menu")
   love.timer.sleep(0.12)
   print("movement.")
   love.timer.sleep(0.12)
   print("spacebar = sprint")
   love.timer.sleep(0.12)
   print("\'o\' = select")
   love.timer.sleep(0.12)
   print("\'p\' = openMenu")
   love.timer.sleep(0.12)
   print("\'k\' = closeMenu")
   theme:play()
end

function atTile()
   onTile = map[mapY+8][mapX+8]
end

function resetSelector()
   command = 0
   cursorX = 218
   cursorY = 110
   selection = 0
end

function cursorLeft()
   if drawMode == 1 then
      if command == 1 then
         cursorX = 218
         command = 0
         return
      elseif command == 3 then
         cursorX = 218
         command = 2
         return
      end
   elseif drawMode == 2 then
      if selection == 1 then
         cursorX = 218
         selection = 0
         return
      elseif selection == 3 then
         cursorX = 218
         selection = 2
         return
      end
   end
end

function cursorRight()
   if drawMode == 1 then
      if command == 0 then
         cursorX = 302
         command = 1
         return
      elseif command == 2 then
         cursorX = 302
         command = 3
         return
      end
   elseif drawMode == 2 then
      if selection == 0 then
         cursorX = 302
         selection = 1
         return
      elseif selection == 2 then
         cursorX = 302
         selection = 3
         return
      end
   end
end

function cursorUp()
   if drawMode == 1 then
      if command == 2 then
         cursorY = 110
         command = 0
         return
      elseif command == 3 then
         cursorY = 110
         command = 1
         return
      end
   elseif drawMode == 2 then
      if selection == 2 then
         cursorY = 110
         selection = 0
         return
      elseif selection == 3 then
         cursorY = 110
         selection = 1
         return
      end
   end
end

function cursorDown()
   if drawMode == 1 then
      if command == 0 then
         cursorY = 132
         command = 2
         return
      elseif command == 1 then
         cursorY = 132
         command = 3
         return
      end
   elseif drawMode == 2 then
      if selection == 0 then
         cursorY = 132
         selection = 2
         return
      elseif selection == 1 then
         cursorY = 132
         selection = 3
         return
      end
   end
end

function talk()
   if mapX == 13 and mapY == 0 and (hero.image == n1 or hero.image == n2) then
      hero.magics = hero.magicMax
      print("\nThy magics")
      love.timer.sleep(0.12)
      print("are restored!")
   else
      print("\nNobody")
      love.timer.sleep(0.12)
      print("present")
   end
end

function resetEnemies()
   steps = 0
   encounter = love.math.random(12,32)
   slime.health = love.math.random(8,9)
   slime.attacks = love.math.random(2,3)
   slime.level = love.math.random(4,6)
   slime.gold = love.math.random(4,6)
   redSlime.health = love.math.random(10,12)
   redSlime.attacks = love.math.random(6,8)
   redSlime.level = love.math.random(6,8)
   redSlime.gold = love.math.random(6,8)
   dracky.health = love.math.random(12,14)
   dracky.attacks = love.math.random(8,10)
   dracky.level = love.math.random(8,10)
   dracky.gold = love.math.random(8,10)
   greenDragon.health = love.math.random(80,88)
   greenDragon.attacks = love.math.random(30,40)
   greenDragon.level = love.math.random(50,60)
   greenDragon.gold = love.math.random(50,60)
   drawMode = 0
end

function levelUp()
   if hero.experience >= experienceRequired[hero.level] then
      hero.attacks = hero.attacks + attacksGained[hero.level]
      hero.defense = hero.defense + defenseGained[hero.level]
      hero.healthMax = hero.healthMax + healthGained[hero.level]
      hero.magicMax = hero.magicMax + magicGained[hero.level]
      print("\nThy level")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("to "..(hero.level + 1).."!")
      love.timer.sleep(0.8)
      print("\nThy Attack")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("by "..attacksGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy Defense")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("by "..defenseGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy maximum")
      love.timer.sleep(0.12)
      print("Hits increases")
      love.timer.sleep(0.12)
      print("by "..healthGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy maximum")
      love.timer.sleep(0.12)
      print("Magics increases")
      love.timer.sleep(0.12)
      print("by "..magicGained[hero.level].."!")
      hero.level = hero.level + 1
   end
   resetEnemies()
end

function win()
   hero.experience = hero.experience + enemies[enemy].level
   hero.gold = hero.gold + enemies[enemy].gold
   print("\nThou hast")
   love.timer.sleep(0.12)
   print("done well")
   love.timer.sleep(0.12)
   print("in defeating")
   love.timer.sleep(0.12)
   print("the "..enemies[enemy].name..".")
   love.timer.sleep(0.8)
   print("\nThy Experience")
   love.timer.sleep(0.12)
   print("increases")
   love.timer.sleep(0.12)
   print("by "..enemies[enemy].level..".")
   love.timer.sleep(0.12)
   print("\nThy GOLD")
   love.timer.sleep(0.12)
   print("increases")
   love.timer.sleep(0.12)
   print("by "..enemies[enemy].gold..".")
   levelUp()
end

function lose()
   love.audio.stop()
   print("\nThou art")
   love.timer.sleep(0.12)
   print("dead.")
   love.timer.sleep(2)
   love.event.quit()
end

function heroAttack()
   enemies[enemy].health = enemies[enemy].health - hero.attacks
   print("\nHero")
   love.timer.sleep(0.12)
   print("attacks!")
   love.timer.sleep(0.8)
   print("\nThe "..enemies[enemy].name.."'s")
   love.timer.sleep(0.12)
   print("Hit Points")
   love.timer.sleep(0.12)
   print("have been")
   love.timer.sleep(0.12)
   print("reduced")
   love.timer.sleep(0.12)
   print("by "..hero.attacks..".")
end

function enemyAttack()
   damage = enemies[enemy].attacks - hero.defense
   if damage <= 0 then
      damage = 1
   end
   hero.health = hero.health - damage
   print("\nThe "..enemies[enemy].name)
   love.timer.sleep(0.12)
   print("attacks!")
   love.timer.sleep(0.8)
   print("\nThy Hit")
   love.timer.sleep(0.12)
   print("decreased")
   love.timer.sleep(0.12)
   print("by "..damage..".")
end

function strikeOrder()
   strikeRoll = love.math.random(0,10)
   if strikeRoll < 4 then
      enemyAttack()
      love.timer.sleep(0.8)
      if hero.health <= 0 then
         lose()
      else
         heroAttack()
         love.timer.sleep(0.8)
         if enemies[enemy].health <= 0 then
            win()
         else
            print("\nCommand?")
            drawMode = 1
         end
      end
   else
      heroAttack()
      if enemies[enemy].health <= 0 then
         win()
      else
         enemyAttack()
         love.timer.sleep(0.8)
         if hero.health <= 0 then
            lose()
         else
            print("\nCommand?")
            drawMode = 1
         end      
      end
   end
end

function castHeal()
   if hero.magics >= 4 then
      if hero.health < hero.healthMax then
         life = love.math.random(20,25)
         limit = hero.healthMax - hero.health
         if life > limit then
            life = limit
         end
         hero.magics = hero.magics - 4
         hero.health = hero.health + life
         print("\nHero")
         love.timer.sleep(0.12)
         print("chanted")
         love.timer.sleep(0.12)
         print("the spell")
         love.timer.sleep(0.12)
         print("of HEAL.")
      else 
         print("\nThy hits")
         love.timer.sleep(0.12)
         print("cannot")
         love.timer.sleep(0.12)
         print("be raised")
      end
   else
      print("\nThy MP")
      love.timer.sleep(0.12)
      print("is too")
      love.timer.sleep(0.12)
      print("low.")
   end
   drawMode = 1
end

function battleEvents()
   if command == 0 then
      strikeOrder()
   elseif command == 1 then
      x = hero.health      
      castHeal()
      if hero.health > x then
         enemyAttack()
      end
   elseif command == 2 then
      print("\nHero")
      love.timer.sleep(0.12)
      print("started")
      love.timer.sleep(0.12)
      print("to run")
      love.timer.sleep(0.12)
      print("away.")
      love.timer.sleep(0.8)
      resetEnemies()
   elseif command == 3 then
      print("\nOf items")
      love.timer.sleep(0.12)
      print("thou hast")
      love.timer.sleep(0.12)
      print("naught.")
      drawMode = 1
   end
   resetSelector()
end

function worldEvents()
   if steps == encounter then
      if onTile == 2 then
         enemy = love.math.random(2,3)
      elseif onTile == 3 then
         enemy = 4
      else
         enemy = love.math.random(1,2)
      end
      resetSelector()
      print("\nA "..enemies[enemy].name)
      love.timer.sleep(0.12)
      print("draws near!")
      love.timer.sleep(0.4)
      print("\nCommand?")
      drawMode = 1
   end
end

function menuEvents()
   if selection == 0 then
      talk()
   elseif selection == 1 then
      castHeal()
   elseif selection == 2 then
      print("\nMax Health")
      love.timer.sleep(0.12)
      print(hero.healthMax)
      love.timer.sleep(0.12)
      print("\nMax Magic")
      love.timer.sleep(0.12)
      print(hero.magicMax)
      love.timer.sleep(0.12)
      print("\nAttack")
      love.timer.sleep(0.12)
      print(hero.attacks)
      love.timer.sleep(0.12)
      print("\nDefense")
      love.timer.sleep(0.12)
      print(hero.defense)
   elseif selection == 3 then
      print("\nOf items")
      love.timer.sleep(0.12)
      print("thou hast")
      love.timer.sleep(0.12)
      print("naught.")
   end
   resetSelector()
   drawMode = 0
end

function drawWorld()
   for y=1, 15 do
      for x=1, 15 do                                                         
         love.graphics.draw(tile[map[y+mapY][x+mapX]], (x*34), (y*34))
      end
   end
   love.graphics.draw(hero.image, 272, 272)
end

function drawStatus()
   love.graphics.draw(stat, 51, 136)
   love.graphics.print(hero.level,        94, 168)
   love.graphics.print(hero.health,       94, 202)
   love.graphics.print(hero.magics,       94, 236)
   love.graphics.print(hero.gold,         82, 270)
   love.graphics.print(hero.experience,   82, 306)
end

function drawBattle()
   love.graphics.draw(battleFrame, 170, 170)
   love.graphics.draw(enemies[enemy].image, 272, 272)
end

function drawComm()
   love.graphics.draw(battleComm, 204, 85)
   if battleSwitch > 0.66 then
      love.graphics.draw(cursor, cursorX, cursorY)
   end
end

function drawMenu()
   love.graphics.draw(worldComm, 204, 85)
   if menuSwitch > 0.33 then
      love.graphics.draw(cursor, cursorX, cursorY)
   end
end

function love.draw()
   love.graphics.scale(1.375)
   drawWorld()
   drawStatus()
   if drawMode == 1 then
      drawBattle()
      drawComm()
   elseif drawMode == 2 then
      drawMenu()
   elseif drawMode == 3 then
      drawBattle()
   end
end

function love.update(dt)
   battleSwitch = battleSwitch + dt
   if battleRelay == 1 then
      battleEvents()
      battleRelay = 0
      battleSwitch = 0
   end
   if drawMode == 0 then
      heroSwitch = heroSwitch + dt
      if love.keyboard.isDown("s") then
         hero.image = s1
         mapY = mapY + 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            worldEvents()
            steps = steps + 1
         else
            mapY = mapY - 1
         end
      elseif love.keyboard.isDown("w") then
         hero.image = n1
         mapY = mapY - 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            worldEvents()
            steps = steps + 1
         else
            mapY = mapY + 1
         end
      elseif love.keyboard.isDown("a") then
         hero.image = w1
         mapX = mapX - 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            worldEvents()
            steps = steps + 1
         else
            mapX = mapX + 1
         end
      elseif love.keyboard.isDown("d") then
         hero.image = e1
         mapX = mapX + 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            worldEvents()
            steps = steps + 1
         else
            mapX = mapX - 1
         end
      elseif love.keyboard.isDown("p") then
         drawMode = 2
      end
      if heroSwitch >= 0.24 then
         if hero.image == n1 then
            hero.image = n2
         elseif hero.image == n2 then
            hero.image = n1   
         elseif hero.image == s1 then
            hero.image = s2
         elseif hero.image == s2 then
            hero.image = s1
         elseif hero.image == w1 then
            hero.image = w2
         elseif hero.image == w2 then
            hero.image = w1
         elseif hero.image == e1 then
            hero.image = e2
         elseif hero.image == e2 then
            hero.image = e1
         end
         heroSwitch = 0
      end
   elseif drawMode == 1 and battleSwitch > 0.88 then
      if love.keyboard.isDown("a") then
         cursorLeft()
      elseif love.keyboard.isDown("d") then
         cursorRight()
      elseif love.keyboard.isDown("w") then
         cursorUp()
      elseif love.keyboard.isDown("s") then
         cursorDown()
      elseif love.keyboard.isDown("o") then
         drawMode = 3
         battleRelay = 1
      end
   elseif drawMode == 2 then
      menuSwitch = menuSwitch + dt
      if menuSwitch > 0.44 then
         if love.keyboard.isDown("a") then
            cursorLeft()
         elseif love.keyboard.isDown("d") then
            cursorRight()
         elseif love.keyboard.isDown("w") then
            cursorUp()
         elseif love.keyboard.isDown("s") then
            cursorDown()
         elseif love.keyboard.isDown("o") then
            menuEvents()
            menuSwitch = 0
         elseif love.keyboard.isDown("k") then
            resetSelector()
            drawMode = 0
         end
      end
   end
love.timer.sleep(0.12)
end