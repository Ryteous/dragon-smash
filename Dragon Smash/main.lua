map = {
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 3, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 3, 3, 3, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
   { 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, },
}

-------AT-LEVEL------{ 2    3    4    5    6     7     8     9    10    11    12    13    14 }
experienceRequired = { 5,  10,  20,  40,  70,  110,  160,  220,  290,  370,  460,  560,  600 }
attacksGained      = { 1,   1,   2,   2,   3,    3,    4,    4,    5,    5,    6,    6,    7 }
defenseGained      = { 1,   1,   1,   2,   2,    2,    3,    3,    3,    4,    4,    4,    5 }
healthGained       = { 1,   1,   2,   2,   3,    3,    4,    4,    5,    5,    6,    6,    7 }
magicGained        = { 1,   1,   1,   2,   2,    2,    3,    3,    3,    4,    4,    4,    5 }
-------AT-LEVEL------{ 2    3    4    5    6     7     8     9    10    11    12    13    14 }

love.window.setTitle("Dragon Smash")
love.window.setMode(800, 800)
love.window.setPosition(80, 0)

TILE_SIZE = 34
SCREEN_SIZE = 15

s1 = love.graphics.newImage("heroS1.png")
s2 = love.graphics.newImage("heroS2.png")
n1 = love.graphics.newImage("heroN1.png")
n2 = love.graphics.newImage("heroN2.png")
w1 = love.graphics.newImage("heroW1.png")
w2 = love.graphics.newImage("heroW2.png")
e1 = love.graphics.newImage("heroE1.png")
e2 = love.graphics.newImage("heroE2.png")

hero = {}
hero.image = s1
hero.healthMax = 0
hero.magicMax = 0
hero.attacks = 0
hero.defense = 0
hero.experience = 0
hero.level = 1
hero.gold = 0

slime = {}
slime.image = love.graphics.newImage("slime.png")
slime.name = "Slime"

redSlime = {}
redSlime.image = love.graphics.newImage("redslime.png")
redSlime.name = "Red Slime"

dracky = {}
dracky.image = love.graphics.newImage("dracky.png")
dracky.name = "Dracky"

greenDragon = {}
greenDragon.image = love.graphics.newImage("greenDragon.png")
greenDragon.name = "Green Dragon"

enemies = {}
enemies[1] = slime
enemies[2] = redSlime
enemies[3] = dracky
enemies[4] = greenDragon
enemy = 0

tile = {}
for i = 0, 4 do
   tile[i] = love.graphics.newImage("tile"..i..".png")
end
onTile = 0
mapX = 13
mapY = 0
mapW = 41
mapH = 46
battleFrame = love.graphics.newImage("battleFrame.png")
battleMenu = {"Attack", "Magic", "Run"}
command = 0
worldMenu = {"Heal", "Talk", "End"}
selection = 0
cursorBase = 208
cursorHead = 213
drawMode = 0
steps = 0
encounter = 0
buf = 0
bef = 0
relay = 0
theme = love.audio.newSource("overworldTheme.wav")
theme:setLooping(true)

function love.load()
   hero.healthMax = love.math.random(10,12)
   hero.health = hero.healthMax
   hero.magicMax = love.math.random(10,12)
   hero.magics = hero.magicMax
   hero.attacks = love.math.random(5,7)
   hero.defense = love.math.random(1,2)
   resetEnemies()
   theme:play()
end

function atTile()
   onTile = map[mapY+8][mapX+8]
end

function resetSelector()
   command = 0
   selection = 0
   cursorBase = 208
   cursorHead = 213
end

function cursorLeft()
   if drawMode == 1 then
      if command > 0 then
         cursorBase = cursorBase - 60
         cursorHead = cursorHead - 60
         command = command - 1
      end
   elseif drawMode == 2 then
      if selection > 0 then
         cursorBase = cursorBase - 60
         cursorHead = cursorHead - 60
         selection = selection - 1
      end
   end
end

function cursorRight()
   if drawMode == 1 then
      if command < 2 then
         cursorBase = cursorBase + 60
         cursorHead = cursorHead + 60
         command = command + 1
      end
   elseif drawMode == 2 then
      if selection < 2 then
         cursorBase = cursorBase + 60
         cursorHead = cursorHead + 60
         selection = selection + 1
      end
   end
end

function talk()
   if mapX == 13 and mapY == 0 and (hero.image == n1 or hero.image == n2) then
      hero.magics = hero.magicMax
      print("\nThy magics")
      love.timer.sleep(0.12)
      print("are restored!")
   else
      print("\nNobody")
      love.timer.sleep(0.12)
      print("present")
   end
end

function resetEnemies()
   steps = 0
   encounter = love.math.random(12,32)
   slime.health = love.math.random(6,8)
   slime.attacks = love.math.random(2,4)
   slime.level = love.math.random(2,4)
   slime.gold = love.math.random(2,4)
   redSlime.health = love.math.random(8,10)
   redSlime.attacks = love.math.random(4,6)
   redSlime.level = love.math.random(4,6)
   redSlime.gold = love.math.random(4,6)
   dracky.health = love.math.random(10,12)
   dracky.attacks = love.math.random(6,8)
   dracky.level = love.math.random(6,8)
   dracky.gold = love.math.random(6,8)
   greenDragon.health = love.math.random(60,80)
   greenDragon.attacks = love.math.random(50,60)
   greenDragon.level = love.math.random(50,60)
   greenDragon.gold = love.math.random(50,60)
end

function levelUp()
   if hero.experience >= experienceRequired[hero.level] then
      hero.attacks = hero.attacks + attacksGained[hero.level]
      hero.defense = hero.defense + defenseGained[hero.level]
      hero.healthMax = hero.healthMax + healthGained[hero.level]
      hero.magicMax = hero.magicMax + magicGained[hero.level]
      print("\nThy level")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("to "..(hero.level + 1).."!")
      love.timer.sleep(0.8)
      print("\nThy Attack")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("by "..attacksGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy Defense")
      love.timer.sleep(0.12)
      print("increases")
      love.timer.sleep(0.12)
      print("by "..defenseGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy maximum")
      love.timer.sleep(0.12)
      print("Hits increases")
      love.timer.sleep(0.12)
      print("by "..healthGained[hero.level].."!")
      love.timer.sleep(0.4)
      print("\nThy maximum")
      love.timer.sleep(0.12)
      print("Magics increases")
      love.timer.sleep(0.12)
      print("by "..magicGained[hero.level].."!")
      hero.level = hero.level + 1
   end
end

function win()
   hero.experience = hero.experience + enemies[enemy].level
   hero.gold = hero.gold + enemies[enemy].gold
   print("\nThou hast")
   love.timer.sleep(0.12)
   print("done well")
   love.timer.sleep(0.12)
   print("in defeating")
   love.timer.sleep(0.12)
   print("the "..enemies[enemy].name..".")
   love.timer.sleep(0.8)
   print("\nThy Experience")
   love.timer.sleep(0.12)
   print("increases")
   love.timer.sleep(0.12)
   print("by "..enemies[enemy].level..".")
   love.timer.sleep(0.12)
   print("\nThy GOLD")
   love.timer.sleep(0.12)
   print("increases")
   love.timer.sleep(0.12)
   print("by "..enemies[enemy].gold..".")
   resetEnemies()
   levelUp()
   drawMode = 0
end

function lose()
   love.audio.stop()
   print("\nThou art")
   love.timer.sleep(0.12)
   print("dead.")
   love.timer.sleep(2)
   love.event.quit()
end

function heroAttack()
   enemies[enemy].health = enemies[enemy].health - hero.attacks
   print("\nHero")
   love.timer.sleep(0.12)
   print("attacks!")
   love.timer.sleep(0.8)
   print("\nThe "..enemies[enemy].name.."'s")
   love.timer.sleep(0.12)
   print("Hit Points")
   love.timer.sleep(0.12)
   print("have been")
   love.timer.sleep(0.12)
   print("reduced")
   love.timer.sleep(0.12)
   print("by "..hero.attacks..".")
end

function enemyAttack()
   damage = enemies[enemy].attacks - hero.defense
   if damage <= 0 then
      damage = 1
   end
   hero.health = hero.health - damage
   print("\nThe "..enemies[enemy].name)
   love.timer.sleep(0.12)
   print("attacks!")
   love.timer.sleep(0.8)
   print("\nThy Hit")
   love.timer.sleep(0.12)
   print("decreased")
   love.timer.sleep(0.12)
   print("by "..damage..".")
end

function strikeOrder()
   strikeRoll = love.math.random(0,10)
   if strikeRoll < 4 then
      enemyAttack()
      love.timer.sleep(0.8)
      if hero.health <= 0 then
         lose()
      else
         heroAttack()
         love.timer.sleep(0.8)
         if enemies[enemy].health <= 0 then
            win()
         else
            print("\nCommand?")
            drawMode = 1
         end
      end
   else
      heroAttack()
      if enemies[enemy].health <= 0 then
         win()
      else
         enemyAttack()
         love.timer.sleep(0.8)
         if hero.health <= 0 then
            lose()
         else
            print("\nCommand?")
            drawMode =1
         end      
      end
   end
end

function castHeal()
   if hero.magics >= 4 then
      if hero.health < hero.healthMax then
         life = love.math.random(20,25)
         limit = hero.healthMax - hero.health
         if life > limit then
            life = limit
         end
         hero.magics = hero.magics - 4
         hero.health = hero.health + life
         print("\nHero")
         love.timer.sleep(0.12)
         print("chanted")
         love.timer.sleep(0.12)
         print("the spell")
         love.timer.sleep(0.12)
         print("of HEAL.")
      else 
         print("\nThy hits")
         love.timer.sleep(0.12)
         print("cannot")
         love.timer.sleep(0.12)
         print("be raised")
      end
   else
      print("\nThy MP")
      love.timer.sleep(0.12)
      print("is too")
      love.timer.sleep(0.12)
      print("low.")
   end
   drawMode = 1
end

function battleEvents()
   if command == 0 then
      strikeOrder()
   elseif command == 1 then
      x = hero.health      
      castHeal()
      if hero.health > x then
         enemyAttack()
      end
   elseif command == 2 then
      print("\nHero")
      love.timer.sleep(0.12)
      print("started")
      love.timer.sleep(0.12)
      print("to run")
      love.timer.sleep(0.12)
      print("away.")
      love.timer.sleep(0.8)
      resetEnemies()
      drawMode = 0
   end
   resetSelector()
end

function worldEvents()
   if steps == encounter then
      if onTile == 2 then
         enemy = love.math.random(2,3)
      elseif onTile == 3 then
         enemy = 4
      else
         enemy = love.math.random(1,2)
      end
      resetSelector()
      print("\nA "..enemies[enemy].name)
      love.timer.sleep(0.12)
      print("draws near!")
      love.timer.sleep(0.4)
      print("\nCommand?")
      drawMode = 1
   end
end

function menuEvents()
   if selection == 0 then
      castHeal()
   elseif selection == 1 then
      talk()
   end
   resetSelector()
   drawMode = 0
end

function drawWorld()
   love.graphics.rectangle("line",68,3,442, 28)
   love.graphics.print("LVL: "..hero.level,                       72,  5)
   love.graphics.print("EXP: "..hero.experience,                  72, 17)
   love.graphics.print("HP: "..hero.health.."/"..hero.healthMax, 280,  5)
   love.graphics.print("MP: "..hero.magics.."/"..hero.magicMax,  280, 17)
   love.graphics.print("ATK: "..hero.attacks,                     180,  5)
   love.graphics.print("DEF: "..hero.defense,                     180, 17)
   love.graphics.print("GOLD: "..hero.gold,                      430, 17)
   for y=1, SCREEN_SIZE do
      for x=1, SCREEN_SIZE do                                                         
         love.graphics.draw(tile[map[y+mapY][x+mapX]], (x*TILE_SIZE), (y*TILE_SIZE))
      end
   end
   love.graphics.draw(hero.image, 8*TILE_SIZE, 8*TILE_SIZE)
end

function drawBattle()
   love.graphics.draw(battleFrame, 7*TILE_SIZE, 6.2*TILE_SIZE)
   love.graphics.print("OPHP: "..enemies[enemy].health, 430, 5)
   love.graphics.draw(enemies[enemy].image, 8*TILE_SIZE, 8*TILE_SIZE)
end

function drawComm()
   love.graphics.setColor(0,0,0)
   love.graphics.rectangle("fill",204,408,170,24)
   love.graphics.setColor(255,255,255)
   love.graphics.rectangle("line",204,408,170,24)
   for i = 1, 3 do 
      love.graphics.print(battleMenu[i], 160+60*i, 414)
   end
   love.graphics.polygon("fill", cursorBase, 416, cursorHead, 420, cursorBase, 424)
end

function drawMenu()
   love.graphics.rectangle("line",204,408,170,24)
   love.graphics.setColor(0,0,0)
   love.graphics.rectangle("fill",204,408,170,24)
   love.graphics.setColor(255,255,255)
   for i = 1, 3 do
      love.graphics.print(worldMenu[i], 160+60*i, 414)
   end
   love.graphics.polygon("fill", cursorBase, 416, cursorHead, 420, cursorBase, 424)
end

function love.draw()
   love.graphics.scale(1.375)
   drawWorld()
   if drawMode == 1 then
      drawBattle()
      drawComm()
   elseif drawMode == 2 then
      drawMenu()
   elseif drawMode == 3 then
      drawBattle()
   end
end

function love.update(dt)
   bef = bef + dt
   if relay == 1 then
      battleEvents()
      relay = 0
      bef = 0
   end
   if drawMode == 0 then
      if love.keyboard.isDown("s") then
         hero.image = s1
         mapY = mapY + 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            steps = steps + 1
            worldEvents()
         else
            mapY = mapY - 1
         end
      elseif love.keyboard.isDown("w") then
         hero.image = n1
         mapY = mapY - 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            steps = steps + 1
            worldEvents()
         else
            mapY = mapY + 1
         end
      elseif love.keyboard.isDown("a") then
         hero.image = w1
         mapX = mapX - 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            steps = steps + 1
            worldEvents()
         else
            mapX = mapX + 1
         end
      elseif love.keyboard.isDown("d") then
         hero.image = e1
         mapX = mapX + 1
         atTile()
         if onTile ~= 1 and onTile ~= 4 then
            steps = steps + 1
            worldEvents()
         else
            mapX = mapX - 1
         end
      elseif love.keyboard.isDown("k") then
         drawMode = 2
      end
      buf = buf + dt
      if buf >= 0.24 then
         if hero.image == n1 then
            hero.image = n2
         elseif hero.image == n2 then
            hero.image = n1   
         elseif hero.image == s1 then
            hero.image = s2
         elseif hero.image == s2 then
            hero.image = s1
         elseif hero.image == w1 then
            hero.image = w2
         elseif hero.image == w2 then
            hero.image = w1
         elseif hero.image == e1 then
            hero.image = e2
         elseif hero.image == e2 then
            hero.image = e1
         end
         buf = 0
      end
   elseif drawMode == 1 and bef > 3.5 then
      if love.keyboard.isDown("a") then
         cursorLeft()
      elseif love.keyboard.isDown("d") then
         cursorRight()
      elseif love.keyboard.isDown("o") then
         drawMode = 3
         relay = 1
      end
   elseif drawMode == 2 then
      if love.keyboard.isDown("a") then
         cursorLeft()
      elseif love.keyboard.isDown("d") then
         cursorRight()
      elseif love.keyboard.isDown("o") then
         menuEvents()
      end
   end
   love.timer.sleep(0.1)  
end